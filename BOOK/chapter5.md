# 第五章 初始化和清理

`c++`中有构造函数和析构函数，`java`中只有构造器，释放空间则是依靠垃圾回收机制。

## 5.1 用构造器确保初始化
和`cpp`中一样JAVA的构造器和类名称相同，在调用`new classname()`时。Java虚拟机将会自动为类分配空间，同时调用相应的构造器。确保操作前类对象已经被初始化。构造器可以接受参数，在初始化时进行带参初始化。

> 构造器是一种特殊的方法是没有返回值的。

## 5.2 方法重载

同样名称不同输入的方法叫做方法重载。这样可以使得构造器接受不同类型的输入。

### 5.2.1 区分方法重载

每个重载的方法都有独一无二的参数类型表，这是区分它们的主要方法。

### 5.2.2 设计基本类型的重载

基本类型的数据类型可以提升，所以一个`short`变量可以如果没有与之对应的`short`方法。就会调用参数`int`，`long`甚至`float`和`double`进行处理。但是`long`和`int`如果不强制类型转换则不会调用参数为`short`的方法。

### 5.2.3 以返回值区分重载方法

因为有时调用不会接收返回值，所以无法使用返回值作为区分重载的方法。

## 5.3 默认构造器

默认构造器是一种没有形势参数的构造器。如果没有写任何构造器，编译器会自动帮你创建一个构造器。

## 5.4 this关键词

`this`关键词用来表示对象本身， 编译器实际上调用对象的方法是将this作为参数传入方法，这点和python很像，不过Python中显示的写出了`self`。而 java 中这一切都是编译器自动完成的。和 python 不同 java 中方法内部调用对象其他方法不需要显示使用`this.anothermethod`。this常见的用途有:

1. `return this`返回对象本身,方便构建`instance.method_a().method_b().method_c()`这样的连续调用。
2. 对象的某些操作在对象外部进行时将对象作为参数传给对方。(这个外部方法可以操作一些不同的类）
3. 在构造器中调用构造器。

### 5.4.1 在构造器中调用构造器

构造器中调用其他构造器可以复用代码，不过要注意。
1. 一个构造器只能通过this调用一个构造器，不能调用两次。
2. 调用必须在起始位置。
3. 编译器禁止其他非构造器方法调用构造器。

### 5.4.2 static 的含义

带有static关键词的方法是全局方法，其内部不能使用this关键词。在java中应该避免过多出现全局方法。

## 5.5 清理：

java中有`finialize`方法，会在对象被标记可以释放时调用。但是这个方法不等于`cpp`中的析构函数，因为对象并不一定会被垃圾回收释放空间。

### 5.5.1 finalize的用途

finialize用于释放，java中非新建对象时申请的内存，比如调用c接口`malloc`出来的内存。

### 5.5.2 你必须实施清理

`c++`中程序员必须手动清理内存，而java不允许创建局部对象，也不能直接调`finalize`。

### 5.5.3 终结条件

`finialize`还能用来追踪，某个对象在回收前是否被妥善处理过，在`finialize`中加入判断条件，如果条件成立则报错。

```java
system.gc() // 会强制出发GC
```

### 5.5.4 垃圾回收器如何工作

- java垃圾清理器会遍历引用的树状结构，找出所有没有引用的对象。
- 清理时停止程序运行，将活的对象从一个堆移动到另一个堆。形成连续空间。这叫`停止-复制`模式
- 程序进入稳定运行时期会将没有引用的对象标记，在最后完成后释放对象空间。但是这样清理出来内存空间不连续。这是`标记-清扫`模式
-  `停止-复制`和`标记-清扫`都不是后台进行的都会导致程序运行停止。

## 5.6 成员初始化

和`c`一样基本类型没有初始化就进行运算会导致错误, 类中其他对象的引用没有赋值时会有一个`null`空指针。不同的是类中的基本类型则有默认初值。

### 5.6.1 指定初始化

和C类似变量最好在定义时进行初始化。

## 5.7 构造器初始化

### 5.7.1初始化顺序

对象的变量初始化在构造器执行之前完成。

### 5.7.2 静态数据初始化

静态数据的初始化在载入类的过程中完成，比非静态变量更早。静态变量初始化只会进行一次。类似python中的`classmethod`

### 5.7.3 显示的静态初始化

可以将静态变量的初始化合成静态语句

```java
class a {
    static int i;
    static int j;
    static {
        i = 1;
        j = 2;
    }
}
```

### 5.7.4 非静态实例初始化

非静态变量的初始化也能通过`{}`进行,这个方法叫实例初始化。

## 5.8 数组初始化

java 中的数组都是用`类型 + []`表示，也支持c中类似的方法。初始化数组的方法有:
```java
int[] a1 = {1,2,3,4,5} // 用 {} 初始化，只能在初始化使用
int[] a2 = new int[]{1,2,3,4,5} // 可以在任何地方使用
```

> 和c不同，java中数组都有固定成员记录数组中元素个数，下标超过元素个数会报错。 

> 打印数组可以用标准类库中的Arrays.toString() 

### 5.8.1 可变参数列表

上面第二种数组方式可以用于可变参数列表，不过在新版本中可以使用新的动态参数实现它。动态参数个数可以为0.

```java
void f(int required, String... args){}
```

可变参数会使得重载变得复杂，可以增加非可变参数来解决这个问题。

## 5.9 枚举类型
枚举类型的使用和c中类似，不过它是类，拥有`toString`显示名称，`ordinal`显示顺序，而不只是一些自然数。`enum`和`switch`语句可以结合。

## 5.10 总结
